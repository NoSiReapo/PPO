**Дата:** 23 декабря 2023 г.

**Статус:**

**Контекст:**

При разработке платформы для мониторинга, анализа и отчетности по потреблению электроэнергии в домах и промышленных объектах мы стоим перед выбором брокера сообщений. От этого выбора зависит будет ли использоваться и если будет то какой и какие особенности у него есть .

**Рассмотренные варианты:**

1. **Без брокера сообщений**.
2. **RabbitMQ** - классический брокер, в котором присутствуют две сущности _–_ продюсер (система, генерирующая сообщения о разнообразных событиях) и подписчик, являющийся получателем этих сообщений. Основной особенностью этого брокера является возможность настройки гибкого роутинга: при отправке сообщение необязательно должно проходить только прямолинейный путь от продюсера к подписчику. В процессе оно может проходить через ряд промежуточных узлов обмена, которые могут перенаправлять его в различные очереди.
3. **Apache Kafka** - представляет собой брокер, который, в отличие от RabbitMQ, хранит все сообщения в виде распределённого лога, причём гарантируется, что порядок сообщений отражает последовательность их поступления в систему. Сообщение в этом логе хранится в течение определённого времени, и работа построена таким образом, что продюсеры пишут новые сообщения в систему, а подписчики сами их запрашивают. При надобности организуется хранение сообщений в рамках тем. То есть можно сказать, что происходит определённого рода группировка сообщений в рамках одной темы.
4. **Platform V Corax** - это платформа для работы с потоками данных, обладающая высокой производительностью и отказоустойчивостью. Разработана на базе открытого программного обеспечения Apache Kafka.

**Решение:**
**Apache Kafka**

**Обоснование:**
 
1. **Распределенность -** отдельные узлы системы располагаются на нескольких аппаратных платформах (кластерах). Это обеспечивает ей высокую отказоустойчивость;
2. **Масштабируемость -** систему можно наращивать за счет простого добавления новых узлов (брокеров сообщений).
3.  **Производительность -** процессы генерирования/отправки и считывания сообщений организованы независимо друг от друга.
4. **Отказоустойчивость -** Kafka — распределенная система обмена сообщениями, узлы которой содержатся на нескольких кластерах. Принимая сообщение от продюсера, она реплицирует (копирует) его, а копии сохраняет на разных узлах. При этом один из брокеров назначается ведомым в секции, через него потребители будут обращаться к записям. Другие брокеры остаются ведомыми, их главная задача — обеспечить сохранность сообщения (его копий) даже при выходе одного или нескольких узлов из строя. Распределенный характер и механизм репликации записей обеспечивают системе высокую устойчивость. (Надежность повышает интеграция с Apache ZooKeeper, которая обеспечивает координацию компонентов друг с другом.)


**Последствия:**

2. Нужно настроить интеграцию с Kubernetes.